import{s as R,ap as W,r as X,j as v,y as z,aq as F,A as Y,ar as Z,$ as j,d as G,R as ee,g as ae,a as m,k as S,F as q,E as le,O as te,P as ne,n as w,f as A,b as _,H as k,l as U,c as L,D as V,ac as H,e as de,t as ie,w as oe,as as re,S as $,ab as J,p as ce,a5 as se}from"./index-aae22775.js";import{q as ue}from"./index2-08f7c804.js";const he=R(W),pe={id:"id",title:"title",parent:"parent",checked:"checked",children:"children",disabled:"disabled",expanded:"spread",leaf:"leaf"},Q=Symbol("LayTreeContext");function fe(i,h){const s=X([]),p=v(()=>Object.assign({},pe,i.replaceFields)),u=v(()=>{const e=[],l=t=>{t.forEach(a=>{var n;e.push(a),(n=a.children)!=null&&n.length&&l(a.children)})};return l(s.value),e}),C=v(()=>u.value.filter(e=>e.mock)),y=v(()=>u.value.filter(e=>e.checked)),N=v(()=>y.value.map(e=>e.id)),b=v(()=>y.value.map(e=>f(e.id).map(l=>l.id))),B=v(()=>y.value.map(e=>e.title)),O=v(()=>y.value.map(e=>f(e.id).map(l=>l.title))),T=v(()=>u.value.filter(e=>e.expanded).map(e=>e.id)),D=v(()=>T.value.map(e=>f(e).map(l=>l.id)));function P(e){return new Promise(l=>{var t,a;if(i.lazy){if(!e)return(t=i.load)==null||t.call(i,void 0,d=>{(d=d.filter(r=>r)).length&&I(d)}),l();if(e!=null&&e.children.length||e.leaf)return l();e.loading=!0;const n=e.disabled;n||(e.disabled=!0),(a=i.load)==null||a.call(i,e.original,d=>{e.loading=!1,n||(e.disabled=!1),I(d=d.filter(r=>r),e.id),d.length||(e.leaf=!0),l()})}else l()})}function I(e,l,t=!1){if(e.length)if(t&&(e=e.map(a=>({...a,mock:!0}))),l){const a=u.value.find(n=>n.id===l);a&&(a.children=[...a.children,...E(e,l)])}else s.value=[...s.value,...E(e)];!t&&K(e),!i.checkStrictly&&c(),j(()=>{h("update:expand-keys",T.value),h("update:checked-keys",N.value)})}function E(e,l){return e.map(t=>{const a=function(d,r){return{id:d[p.value.id],title:d[p.value.title],children:[],parent:r,disabled:!!(d[p.value.disabled]??!1),checked:!!(d[p.value.checked]??!1),expanded:!!(d[p.value.expanded]??!1),isIndeterminate:!1,loading:!1,leaf:!!(d[p.value.leaf]??!1),original:d,mock:d.mock??!1,slot:d.slot,visible:!0}}(t,l),n=t[p.value.children];return a.children=n!=null&&n.length?E(n,a.id):[],a.leaf=a.leaf||!(i.lazy||a.children.length||a.slot),a})}function K(e){const l=e.map(t=>t[p.value.id]);C.value.filter(t=>l.includes(t.id)).forEach(t=>{var a;(a=x(t.id))==null||a.forEach(n=>{const d=(r=>{if(r&&r.parent!==void 0){const g=o(r==null?void 0:r.parent);return g==null?void 0:g.children.splice(g==null?void 0:g.children.indexOf(t),1)}return s.value.splice(s.value.indexOf(t),1)})(n);d==null||d.forEach(r=>{const g=o(r.id);g&&Object.assign(g,{checked:r.checked,isIndeterminate:r.isIndeterminate,expanded:r.expanded})})})})}function x(e){return u.value.filter(l=>l.id===e&&l.mock)}function c(){u.value.filter(e=>!e.disabled&&!e.children.length).forEach(e=>{const l=o(e.parent);l&&(l.checked=l.children.every(t=>t.checked),l.checked||(l.isIndeterminate=l.children.some(t=>t.isIndeterminate||t.checked)))}),u.value.filter(e=>!e.disabled&&e.parent).forEach(e=>{const l=o(e.parent);l&&(l.checked=l.children.every(t=>t.checked),l.checked||(l.isIndeterminate=l.children.some(t=>t.isIndeterminate||t.checked)))}),u.value.filter(e=>!e.disabled&&!e.parent&&e.children.length).forEach(e=>{e.checked=e.children.every(l=>l.checked),e.checked||(e.isIndeterminate=e.children.some(l=>l.isIndeterminate||l.checked))})}function o(e){return u.value.find(l=>l.id===e&&!l.mock)}z(()=>[i.data,i.cacheData],()=>{s.value=[],function(e){e.length?I(e):P().catch(console.error),i.cacheData&&I(i.cacheData,void 0,!0),C.value.length&&K(u.value.filter(l=>!l.mock).map(l=>l.original))}(F(Y(i.data)?i.data:[i.data]))},{deep:!0,immediate:!0});function f(e){let l=o(e);const t=[];if(l)for(t.push(l);l!=null&&l.parent&&(l=o(l.parent),l);)t.push(l);return t.reverse()}return z(()=>i.defaultExpandAll,e=>{!i.lazy&&Z(e)&&j(()=>{u.value.forEach(l=>{l.expanded=e}),i.checkStrictly||c()})},{immediate:!0}),z(()=>i.checkedKeys,(e,l)=>{var t;(t=l==null?void 0:l.filter(a=>!(e!=null&&e.includes(a))))==null||t.forEach(a=>{var n;o(a)&&(o(a).checked=!1),(n=x(a))==null||n.forEach(d=>d.checked=!1)}),e==null||e.forEach(a=>{var n;o(a)&&(o(a).checked=!0),(n=x(a))==null||n.forEach(d=>d.checked=!0)}),i.checkStrictly||c()},{immediate:!0}),z(()=>i.expandKeys,(e,l)=>{var t;(t=l==null?void 0:l.filter(a=>!(e!=null&&e.includes(a))))==null||t.forEach(a=>{var n;o(a)&&(o(a).expanded=!1),(n=x(a))==null||n.forEach(d=>d.expanded=!1)}),e==null||e.forEach(a=>{var n;o(a)&&(o(a).expanded=!0),(n=x(a))==null||n.forEach(d=>d.expanded=!0)}),i.checkStrictly||c()},{immediate:!0}),{treeData:s,flatTree:u,findNode:o,findMockNodes:x,findNodePath:f,findParentNode:e=>{const l=u.value.find(t=>t.id===e);return u.value.find(t=>t.id===(l==null?void 0:l.parent))},findSiblingsNodes:e=>{var l;const t=u.value.find(a=>a.id===e);return t!=null&&t.parent?(l=u.value.find(a=>a.id===t.parent))==null?void 0:l.children:s.value},findAllLeafNodes:function e(l){const t=u.value.find(a=>a.id===l);if(t)return F(t.children.flatMap(a=>a.children.length?e(a.id):a))},lazyLoad:P,reloadAllNodeStatus:c,filter:function(e){const l=function(t){t.forEach(a=>{const n=a.children;if(a.visible=i.searchNodeMethod(a.original,e),l(n),!a.visible&&n.length){let d=!0;d=!n.some(r=>r.visible),a.visible=d===!1}e&&(!a.visible||a.expanded||i.lazy||(a.expanded=!0))})};l(s.value)},expandedKeys:T,expandedPath:D,checkedKeys:N,checkedPath:b,checkedTitle:B,checkedTitlePath:O}}const ye=R(ue),ke={class:"layui-tree-block"},ve={class:"layui-tree-main"},me=["onClickCapture"],ge=["onDblclick","onContextmenu","onClick"],xe=G({name:"LayTreeNode",__name:"TreeNode",props:{tree:{},data:{},checkedKeys:{},expandKeys:{},checkStrictly:{type:[Boolean,String]},collapseTransition:{type:Boolean},onlyIconControl:{type:Boolean},selectedKey:{},showLine:{type:Boolean},standalone:{type:Boolean},showCheckbox:{type:Boolean},replaceFields:{},shouldIconBorder:{},tailNodeIcon:{type:[String,Boolean,Function]},defaultExpandAll:{type:Boolean},cacheData:{},lazy:{type:Boolean},load:{},loadOnCheck:{type:Boolean},searchNodeMethod:{},accordion:{type:Boolean}},setup(i){const h=i,{treeEmits:s,treeSlots:p,useTreeData:{treeData:u,flatTree:C,lazyLoad:y,findNode:N,findNodePath:b,findSiblingsNodes:B,findAllLeafNodes:O,reloadAllNodeStatus:T,checkedKeys:D,expandedPath:P}}=ee(Q);function I(c){const o=B(c.parent)??[];return o.findIndex(f=>f.id===c.id)===o.length-1}function E(c){return $(h.tailNodeIcon)?h.tailNodeIcon(c):c.children.length||!c.leaf?h.showLine?c.expanded?"layui-icon-subtraction":"layui-icon-addition":c.expanded?"layui-icon-triangle-d":"layui-icon-triangle-r":h.showLine&&h.tailNodeIcon?h.tailNodeIcon:""}function K(c){const o=E(c);return!!["layui-icon-subtraction","layui-icon-addition"].includes(o)||!!$(h.shouldIconBorder)&&!!h.shouldIconBorder(o)}async function x(c,o){if(await y(o),o.expanded=!o.expanded,h.accordion){const f=b(o.id).map(a=>a.id),e=P.value,l=F(e.filter(a=>a.at(0)!==f.at(0)).map(a=>N(a.at(0)))),t=f.length>=2&&F(e.filter(a=>a.length===f.length&&a.at(0)===f.at(0)&&a.at(-1)!==f.at(-1)).map(a=>N(a.at(-1)))).filter(a=>a.expanded);l.forEach(a=>a.expanded=!1),t&&t.forEach(a=>a.expanded=!1)}s("update:expand-keys",C.value.filter(f=>f.expanded).map(f=>f.id)??[]),s("update:checked-keys",D.value)}return(c,o)=>{const f=ae("tree-node",!0);return m(),S("div",ke,[(m(!0),S(q,null,le(c.tree??k(u)??[],(e,l)=>te((m(),S("div",{key:l,class:w(["layui-tree-set",[{"layui-tree-set-end":!h.standalone&&I(e)}]])},[A("div",{class:w(["layui-tree-entry",[{"layui-this":c.selectedKey===e.id}]])},[A("div",ve,[A("span",{class:w(["layui-tree-iconClick",["layui-tree-icon-"+(K(e)?"border":"no-border"),"layui-tree-icon-"+(E(e).length?"pad-left":"no-pad-left")]]),onClickCapture:t=>{x(0,e)}},[_(k(U),{type:E(e)},null,8,["type"])],42,me),c.showCheckbox?(m(),L(k(ye),{key:0,modelValue:e.checked,"onUpdate:modelValue":t=>e.checked=t,value:e.checked?1:0,skin:"primary",disabled:e.disabled,"is-indeterminate":e.isIndeterminate,onChange:t=>function(a,n){const d=r=>{if(h.checkStrictly)return r.checked=a,s("check-change",r.original,a),void s("update:checked-keys",D.value??[]);const g=O(r.id);r.isIndeterminate&&(a=!1),g==null||g.filter(M=>!M.disabled).forEach(M=>{M.checked=a}),T(),s("check-change",r.original,r.checked),s("update:checked-keys",D.value)};h.loadOnCheck?y(n).catch(console.warn).finally(()=>d(n)):d(n)}(t,e)},null,8,["modelValue","onUpdate:modelValue","value","disabled","is-indeterminate","onChange"])):V("",!0),e.loading?(m(),L(k(U),{key:1,class:"layui-tree-loading layui-anim layui-anim-rotate layui-anim-loop",type:"layui-icon-loading"})):V("",!0),A("span",{class:w(["layui-tree-txt",[e.disabled&&"layui-disabled"]]),onDblclick:t=>{return n=e,(a=t).stopPropagation(),a.preventDefault(),void s("node-double",a,n.original);var a,n},onContextmenu:t=>{return n=e,(a=t).stopPropagation(),a.preventDefault(),void s("node-contextmenu",a,n.original);var a,n},onClick:t=>{return(a=e).disabled||(s("update:selected-key",a.id),s("node-click",a.original)),void(h.onlyIconControl||x(0,a));var a}},[k(p).title?(m(),L(k(H),{key:0,data:e.original,slots:k(p),render:"title"},null,8,["data","slots"])):(m(),S(q,{key:1},[de(ie(e.title),1)],64))],42,ge)])],2),_(k(he),{enable:c.collapseTransition},{default:oe(()=>[e.expanded?(m(),S("div",{key:0,class:w(["layui-tree-pack",[{"layui-tree-showLine":c.showLine}]])},[k(re)(e.slot)&&k(p)[e.slot]||k($)(e.slot)?(m(),L(k(H),{key:0,render:e.slot,slots:k(p),data:e.original},null,8,["render","slots","data"])):(m(),L(f,J({key:1},h,{tree:e.children}),null,16,["tree"]))],2)):V("",!0)]),_:2},1032,["enable"])],2)),[[ne,!e.mock&&e.visible]])),128))])}}}),Be=G({name:"LayTree",__name:"index",props:{data:{},checkedKeys:{default:()=>[]},expandKeys:{default:()=>[]},checkStrictly:{type:[Boolean,String],default:!1},collapseTransition:{type:Boolean,default:!0},onlyIconControl:{type:Boolean,default:!1},selectedKey:{},showLine:{type:Boolean,default:!0},standalone:{type:Boolean,default:!1},showCheckbox:{type:Boolean,default:!1},replaceFields:{},shouldIconBorder:{},tailNodeIcon:{type:[String,Boolean,Function],default:"layui-icon-file"},defaultExpandAll:{type:Boolean,default:void 0},cacheData:{},lazy:{type:Boolean,default:!1},load:{},loadOnCheck:{type:Boolean},searchNodeMethod:{},accordion:{type:Boolean}},emits:["update:selected-key","update:checked-keys","update:expand-keys","node-click","check-change","node-double","node-contextmenu"],setup(i,{expose:h,emit:s}){const p=i,u=s,C=ce(),y=fe(p,u),N=v(()=>["layui-tree","layui-tree-"+(p.showLine?"line":"unline"),p.showCheckbox&&"layui-form"]);return se(Q,{treeEmits:u,treeSlots:C,useTreeData:y}),h({filter:function(b){if(!p.searchNodeMethod)throw new Error("[Layui-vue/Tree] filterNodeMethod为空");y.filter(b)},getTree:()=>y.treeData,getFlatTree:()=>y.flatTree,getNode:function(){return b=>{const B=y.findNode(b);return B&&B.original}}}),(b,B)=>(m(),S("div",{class:w(N.value)},[_(xe,J(p,{tree:k(y).treeData.value}),null,16,["tree"])],2))}});export{Be as S,pe as e};
